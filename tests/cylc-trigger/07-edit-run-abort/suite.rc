[meta]
    title = A suite to test an aborted edit run has no subsequent effect.
[cylc]
    [[events]]
        abort on timeout = True
        timeout = PT20S
[scheduling]
    [[graph]]
# SoD: aborted edit-run currently needs the --task-pool trigger option, which
# needs target tasks to be in the pool, so victim is an unhandled failed task.
        R1 = """
victim
perpetrator
"""

[runtime]
    [[victim]]
        script = """
echo HELLO
test $CYLC_TASK_SUBMIT_NUMBER -eq 2
"""
    [[perpetrator]]
        script = """
# Edit run to break victim, but abort after the edit.
# If the edit run is actioned the edited task will fail instead of succeed (at
# submit number 2).
cylc trigger --task-pool --edit $CYLC_SUITE_NAME victim.1 << __END__
n
__END__
# Add a new line (for nicer output).
echo

# Give the state summary a chance to update.
sleep 2

# Test that the NN symbolic link is correct.
test $(readlink ${CYLC_SUITE_RUN_DIR}/log/job/1/victim/NN) = '01'

my-suite-state-summary-test \
    < <(cylc client -n "${CYLC_SUITE_NAME}" 'get_suite_state_summary')

# Then trigger victim - the original unedited task should run (and succeed at
# submit number 2).
cylc trigger --task-pool $CYLC_SUITE_NAME victim.1
"""
